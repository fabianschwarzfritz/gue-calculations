<!DOCTYPE html>
<html>
<body>

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<link rel="stylesheet" type="text/css" href="style.css"/>

<script>
document.addEventListener('DOMContentLoaded', function () {
  var fields = ["tanksize", "pressurebefore", "pressureafter", "time", "depth"]

  function bootstrap() {
    fields.forEach(function(field) {
      var label = document.querySelectorAll("label[class^=label-"+field);
      var input = document.getElementById(field);
      input.addEventListener("change", function(e) {
        var value = e.target.value;
        label[0].innerHTML = value;
      });
    })
  }
  bootstrap();

  function displayResultInTable(result) {
    console.log(result)
    var table = document.getElementById("result")
    table.innerHTML = ""
    result.forEach(function(entry) {
      console.log(entry)
      var cellkey = document.createTextNode(entry.name)
      var columnkey = document.createElement("td")
      columnkey.appendChild(cellkey)

      var cellvalue = document.createTextNode(entry.value + " " + entry.unit)
      var columnvalue = document.createElement("td")
      columnvalue.appendChild(cellvalue)

      var row = document.createElement("tr")
      row.appendChild(columnkey)
      row.appendChild(columnvalue)

      table.appendChild(row)
    })
  }

  function validateField() {
    var values = {};
    fields.forEach(function(field) {
      var input = document.getElementById(field);
      values[field] = input.value
      if(!values[field]) {
        input.setAttribute("class", "error")
        throw new Error("Invalid field: ", field);
      }
    })
    return values
  }

  function calculateamv() {
    var values = {};
    try {
      values = validateField();
    } catch(err) {
      return;
    }

    var amv = (values["tanksize"] * (values["pressurebefore"] - values["pressureafter"]))
              / ( values["time"] * (((values["depth"] / 2) / 10) + 1) )
    amv = Math.round(amv)
    alert("Your average gas usage: " + amv + " l/min")
    var result = [{
      name: "Tank size",
      value: values["tanksize"],
      unit: "liters"
    }, {
      name: "Pressure before dive",
      value: values["pressurebefore"],
      unit: "bar"
    }, {
      name: "Pressure after dive",
      value: values["pressureafter"],
      unit: "bar"
    }, {
      name: "Time",
      value: values["time"],
      unit: "minutes",
    }, {
      name: "Maximum depth",
      value: values["depth"],
      unit: "meters"
    }, {
      name: "Atem minuten volumen",
      value: amv,
      unit: "l/min"
    }]
    displayResultInTable(result)
  }

  document.getElementById("calculateamv").addEventListener("click", calculateamv)
});
</script>

<div class="parameter-input">
  <h1>GUE Average Gas Usage Calculator</h1>
  <form action="javascript:void(0);">
    <label>Tank Size:</label>
    <select id="tanksize">
      <option value="10">S10</option>
      <option value="11">S11</option>
      <option value="12">S12</option>
      <option value="15">S15</option>
      <option value="14">D7</option>
      <option value="17">D8.5</option>
      <option value="20">D10</option>
      <option value="24">D12</option>
      <option value="30">D15</option>
    </select><br>
    <label>Pressure before dive: </label><label class="label-pressurebefore">40</label>
    <input id="pressurebefore" name="pressurebefore" type="range" min="40" max="250" value="40" step="10"><br>
    <label>Pressure after dive: </label><label class="label-pressureafter">40</label>
    <input id="pressureafter" name="pressureafter" type="range" min="40" max="200" value="40" step="10"><br>
    <label>Time: </label><label class="label-time">10</label>
    <input id="time" name="time" type="range" min="10" max="180" value="10" step="5"><br>
    <label>Maximum depth: </label><label class="label-depth">3</label>
    <input id="depth" name="depth" type="range" min="3" max="30" value="3"><br>
    <button id="calculateamv">Calculate</button>
  </form>
  <table id="result">
  </table>
</div>

<!-- <h1>GUE Edge</h1>
<b>G</b>oal		Ziel und Plan</br>
<b>U</b>nified Team 	Teamreihenfolge und Aufgaben</br>
<b>E</b>qipment 	Gesamter Equipment Check*</br>
</br>
<b>E</b>xposure		Ziel und Tiefe</br>
<b>D</b>eco		Aufstiegs- und Dekoplanun</br>
<b>G</b>as		Gasparameter, Gasstrategie und Minimumgas</br>
<b>E</b>nvironment	Umgebung, Gefahren, Notfall</br>

<h2>Gesamter Equipment Check</h2>
<ul>
  <li>Ventile offen</li>
  <li>Regler atmen</li>
  <li>Wing (Ein- und Auslässe)</li>
  <li>Anzug (Ein- und Auslass und offen)</li>
  <li>Hauptlampe</li>
  <li>Backuplampen</li>
  <li>Instrumente</li>
  <li>Schritt und Bauchgurt</li>
  <li>Messer</li>
  <li>Finimeter frei</li>
  <li>Blei dabei</li>
  <li>Pinkelventil angeschlossen</li>
  <li>Beintascheninhalt</li>
  <li>Zusatzequipment</li>
  <li>Longhose frei</li>
  <li>Bubble check</li>
</ul>

<h2>AMV Formel</h2>

<p>AMV = Verbrauchtes Gasvolumen (bar l) / Tauchzeit (min) * Durchschnittstiefe (m)</p>
<p>AMV = (Druck vorher (bar) - Druch nachher (bar)) * Flaschengroesse (l) / (Tauchzeit (min) * Durchschnittstiefe in Bar (bar))</p>

<h1>Minimum Gas Table</h1>
<table class="ui celled table">
  <thead>
    <tr>
      <th>CAT</th>
      <th>Tiefe</th>
      <th>Single 10</th>
      <th>Single 11</th>
      <th>Single 12</th>
      <th>Single 15</th>
      <th>Double 7</th>
      <th>Double 8.5</th>
      <th>Double 10</th>
      <th>Double 11</th>
      <th>Double 12</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>40 l/min * 1,5 bar * 5 min = 300 liter</td>
      <td>10 meter</td>
      <td>40 bar</td>
      <td>40 bar</td>
      <td>40 bar</td>
      <td>40 bar</td>
      <td>40 bar</td>
      <td>40 bar</td>
      <td>40 bar</td>
      <td>40 bar</td>
      <td>40 bar</td>
    </tr>
    <tr>
      <td>40 l/min * 2 bar * 8 min = 640 liter</td>
      <td>20 meter</td>
      <td>70 bar</td>
      <td>60 bar</td>
      <td>60 bar</td>
      <td>50 bar</td>
      <td>60 bar</td>
      <td>40 bar</td>
      <td>40 bar</td>
      <td>40 bar</td>
      <td>40 bar</td>
    </tr>
    <tr>
      <td>40 l/min * 2,5 bar * 11 min = 1100 liter</td>
      <td>30 meter</td>
      <td>110 bar</td>
      <td>100 bar</td>
      <td>100 bar</td>
      <td>80 bar</td>
      <td>80 bar</td>
      <td>70 bar</td>
      <td>60 bar</td>
      <td>50 bar</td>
      <td>50 bar</td>
    </tr>
  </tbody>
  <p>
  Beispielrechnung für CAT:<br>
  C - Consumption<br>
  A - Average Pressure<br>
  T - Time<br><br>
  Beispiel hier bei 30 meter<br><br>

  C = 20 l/min AMV * 2 = 40 l/min<br>
  A = (4 bar + 1 bar) / 2 = 2,5 bar<br>
  T = 30 m / 3 + 1 min = 11 min<br>
  </p>
  <p>
    Wenn der berechnete Druck geringer ist als 40 bar, gehen wir trotzdem von einem Mindestdruck von Minimum Gas 40 bar aus.<br>
    Finimeter können ungenau sein und viele Finimeters messen unter 40 bar wesentlich ungenauer.
  </p>
</table> -->

</body>
</html>
